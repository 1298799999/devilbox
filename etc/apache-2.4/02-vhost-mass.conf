##
## Default Mass Virtual Host
##

<VirtualHost *:80>

	# Get the server name from the Host: header
	UseCanonicalName Off

	ServerName  localhost
	ServerAlias	*.loc
	ServerAdmin root@localhost

	# splitlogs.php is a custom script, which will filter the domain
	# and create separate logfiles per domain.
	LogFormat "%V;%h;%l;%u;%t;\"%r\";%>s;%b;\"%{Referer}i\";\"%{User-agent}i\"" vcommon
	CustomLog "|/opt/bin/splitlogs.php" vcommon

	ErrorLog  /var/log/apache-2.4/other-error.log

	DirectoryIndex index.php index.html

	# When using VirtualDocumentRoot the PHP Env var DOCUMENT_ROOT
	# is not filled, so we need to do that manually with a custom script.
	VirtualDocumentRoot /shared/httpd/%-2+/htdocs/
	php_admin_value auto_prepend_file /opt/bin/fix-virtual-docroot.php

	#<FilesMatch "\.php$">
	#	Require all granted
	#	SetHandler proxy:fcgi://172.16.238.11:9000
	#</FilesMatch>


	# enablereuse
	# Defining a worker will improve performance
	# And in this case, re-use the worker (dependent on support from the fcgi application)
	# If you have enough idle workers, this would only improve the performance marginally
	#
	# enablereuse requires Apache 2.4.11 or later
	#<Proxy "fcgi://172.16.238.11:9000/" enablereuse=on max=10></Proxy>
	<FilesMatch "\.php$">
		Require all granted
		# Pick one of the following approaches
		# Use the standard TCP socket
		SetHandler "proxy:fcgi://172.16.238.11:9000"
		# If your version of httpd is 2.4.9 or newer (or has the back-ported feature), you can use the unix domain socket
		#SetHandler "proxy:unix:/path/to/app.sock|fcgi://localhost/:9000"
	</FilesMatch>



	<Directory "/shared/httpd/*/htdocs/">
		DirectoryIndex index.php index.html

		AllowOverride All
		Options All

		RewriteEngine on
		RewriteBase /

		Order allow,deny
		Allow from all
		Require all granted
	</Directory>

</VirtualHost>



